/* 売上数合計の表示 */
function calculateTotalSales() {
  var sheet = SpreadsheetApp.getActiveSpreadsheet();
  var salesSheet = sheet.getSheetByName('売上表');
  var targetSheet = sheet.getSheetByName('2024_11');

  var startDate = new Date('2024-11-01');
  var endDate = new Date('2024-11-30');

  // 集計シートのA列の商品名リスト
  var productList = targetSheet.getRange(2, 1, targetSheet.getLastRow() - 1).getValues(); // 修正箇所: getValues()に変更

  // 売上表のB列からD列まで（販売日、商品名、販売個数）のデータを取得
  var salesData = salesSheet.getRange(2, 2, salesSheet.getLastRow() - 1, 3).getValues(); // 修正箇所: getValues()に変更

  // 各商品の売り上げ数を集計
  for (var i = 0; i < productList.length; i++) {
    var productName = productList[i][0];
    var totalSales = 0;

    // 売上表から該当商品の売り上げ数を合計
    for (var j = 0; j < salesData.length; j++) {
      var salesDate = new Date(salesData[j][0]); // 修正箇所: salesDateに変更し、salesDataを正しく扱う
      var salesName = salesData[j][1];
      var salesAmount = salesData[j][2]; // 修正箇所: salesData[j][2]に変更

      // 販売日の範囲が集計対象期間内かつ、商品名が一致する場合に合計
      if (salesDate >= startDate && salesDate <= endDate && salesName == productName && salesAmount !== "" && salesAmount !== null && !isNaN(salesAmount)) {
        totalSales += salesAmount;
      }
    }

    // E列に売上数合計を表示
    targetSheet.getRange(i + 2, 5).setValue(totalSales);
  }
}
